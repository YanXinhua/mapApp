!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("myopenlayers")):"function"==typeof define&&define.amd?define(["myopenlayers"],t):e.hdmap=t()}(this,function(){"use strict";function e(e,t,o,r){var a=e[o],n=e[o+1],i=r[0]+r[1]*Math.abs(a),l=Math.abs(n)/r[9],s=r[2]+r[3]*l+r[4]*l*l+r[5]*l*l*l+r[6]*l*l*l*l+r[7]*l*l*l*l*l+r[8]*l*l*l*l*l*l;t[o]=i*(a<0?-1:1),t[o+1]=s*(n<0?-1:1)}function t(e,t){var o=function(e,t){var o=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return o+=2*(20*Math.sin(6*e*C)+20*Math.sin(2*e*C))/3,o+=2*(20*Math.sin(t*C)+40*Math.sin(t/3*C))/3,o+=2*(160*Math.sin(t/12*C)+320*Math.sin(t*C/30))/3}(e-105,t-35),r=function(e,t){var o=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return o+=2*(20*Math.sin(6*e*C)+20*Math.sin(2*e*C))/3,o+=2*(20*Math.sin(e*C)+40*Math.sin(e/3*C))/3,o+=2*(150*Math.sin(e/12*C)+300*Math.sin(e/30*C))/3}(e-105,t-35),a=t/180*C,n=Math.sin(a);n=1-T*n*n;var i=Math.sqrt(n);return o=180*o/(b*(1-T)/(n*i)*C),r=180*r/(b/i*Math.cos(a)*C),[r,o]}function o(e,t){return e<72.004||e>137.8347||(t<.8293||t>55.8271)}function r(e,t,o){var r=e[o]-.0065,a=e[o+1]-.006,n=Math.sqrt(r*r+a*a)-2e-5*Math.sin(a*k),i=Math.atan2(a,r)-3e-6*Math.cos(r*k);return t[o]=n*Math.cos(i),t[o+1]=n*Math.sin(i),t}function a(e,t,o){var r=e[o],a=e[o+1],n=Math.sqrt(r*r+a*a)+2e-5*Math.sin(a*k),i=Math.atan2(a,r)+3e-6*Math.cos(r*k);return t[o]=n*Math.cos(i)+.0065,t[o+1]=n*Math.sin(i)+.006,t}function n(e,t){return e.eventCallback[t].default}function i(e){return hdmap.mapManager[e.map.ol_uid]}function l(e){this.controlZoom=!0,this.dragPan=!0,this.attribution=!1,!1===e.controlZoom&&(this.controlZoom=!1),!1===e.dragPan&&(this.dragPan=!1),!0===e.attribution&&(this.attribution=!0),this._map=null,this.layers=[],this._overlay=null,this.popup_container=null,this.popup_closer=null,this.popup_content=null,this.popup_contentWrap=[],this.popup_closestatus=!1,this._overlays=[],this._initNum=0,this._flag=!0,this._outPopupWarp="hdmap-outterPopup",this.outterLayers={},this.eventCallback={singleclick:{default:null},dragstart:{default:null},dragend:{default:null},selected:{default:null},cancelSelected:{default:null},pointermove:{default:null}},this.eventKey={},this.drawTool={},this.mapConfig={},this.dragFeatureTool={},this.mapInit(e),hdmap.mapManager[this.getMapUid()]=this,this.regDefaulEventCallback()}function s(e,t,o){if(!(t.lonlatA[0]>180||t.lonlatA[0]<-180||t.lonlatA[1]>90||t.lonlatA[1]<-90||t.lonlatB[0]>180||t.lonlatB[0]<-180||t.lonlatB[1]>90||t.lonlatB[1]<-90||t.lonlatC[0]>180||t.lonlatC[0]<-180||t.lonlatC[1]>90||t.lonlatC[1]<-90)){var r=p(t,o),a=e.translate_4326_to_3857(r),n=e.translate_4326_to_3857(t.lonlatA),i=e.translate_4326_to_3857(t.lonlatB),l=e.translate_4326_to_3857(t.lonlatC),s=n[0]-a[0],u=n[1]-a[1],c=i[0]-a[0],y=i[1]-a[1],d=l[0]-a[0],h=l[1]-a[1];return((s/o.pointA[0]+u/o.pointA[1])/2+(c/o.pointB[0]+y/o.pointB[1])/2+(d/o.pointC[0]+h/o.pointC[1])/2)/3}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")}function p(e,t){if(!(e.lonlatA[0]>180||e.lonlatA[0]<-180||e.lonlatA[1]>90||e.lonlatA[1]<-90||e.lonlatB[0]>180||e.lonlatB[0]<-180||e.lonlatB[1]>90||e.lonlatB[1]<-90||e.lonlatC[0]>180||e.lonlatC[0]<-180||e.lonlatC[1]>90||e.lonlatC[1]<-90)){var o=e.lonlatA[0]-(e.lonlatB[0]-e.lonlatA[0])*t.pointA[0]/(t.pointB[0]-t.pointA[0]),r=e.lonlatB[1]-(e.lonlatB[1]-e.lonlatA[1])*t.pointB[1]/(t.pointB[1]-t.pointA[1]),a=e.lonlatA[0]-(e.lonlatC[0]-e.lonlatA[0])*t.pointA[0]/(t.pointC[0]-t.pointA[0]),n=e.lonlatC[1]-(e.lonlatC[1]-e.lonlatA[1])*t.pointC[1]/(t.pointC[1]-t.pointA[1]),i=(o+a+(e.lonlatC[0]-(e.lonlatB[0]-e.lonlatC[0])*t.pointC[0]/(t.pointB[0]-t.pointC[0])))/3,l=(r+n+(e.lonlatB[1]-(e.lonlatB[1]-e.lonlatC[1])*t.pointB[1]/(t.pointB[1]-t.pointC[1])))/3,s=[i,l];return i>180||i<-180||l>90||l<-90?(console.warn("Error: centerGPS: ["+s+"] The longitude must be between -180 and 180, latitude must be between -90 and 90"),!1):s}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")}function u(e){for(var t=0,o=[],r=0,a=0,n=1;n<=e.length;n++){var i=e[n%e.length][0],l=e[n%e.length][1],s=e[n-1][0],p=e[n-1][1],u=(i*p-l*s)/2;t+=u,r+=u*(i+s)/3,a+=u*(l+p)/3}return r/=t,a/=t,o[0]=r,o[1]=a,o}function c(e){for(var t=[],o=[],r=[],a=0;a<e.length;a++){var n=Math.abs(e[a][0]),i=Math.abs(e[a][1]);o.push(n),r.push(i)}var l=Math.min.apply(null,o),s=Math.min.apply(null,r),p=Math.abs(u(e)[0]),c=Math.abs(u(e)[1]);return t[0]=Math.abs(l-p)/2,t[1]=Math.abs(s-c)/2,t}var y=function(e){return function(t,o,r){var a,n=t.length,i=r||2;a=o||(2!==i?t.slice():new Array(n));for(var l=0;l<n;l+=i)e(t,a,l);return a}},d={},h=6378137,m=85.0511287798,g=Math.PI/180;d.forward=y(function(e,t,o){var r=Math.max(Math.min(m,e[o+1]),-m),a=Math.sin(r*g);t[o]=h*e[o]*g,t[o+1]=h*Math.log((1+a)/(1-a))/2}),d.inverse=y(function(e,t,o){t[o]=e[o]/h/g,t[o+1]=(2*Math.atan(Math.exp(e[o+1]/h))-Math.PI/2)/g});var f={},v=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],w=[75,60,45,30,15,0],S=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],L=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]];f.forward=y(function(t,o,r){var a,n=function(e,t,o){for(var r=o-t;e>o;)e-=r;for(;e<t;)e+=r;return e}(t[r],-180,180),i=function(e,t,o){return e=Math.max(e,t),e=Math.min(e,o)}(t[r+1],-74,74),l=null;for(a=0;a<w.length;++a)if(i>=w[a]){l=L[a];break}if(null===l)for(a=w.length-1;a>=0;--a)if(i<=-w[a]){l=L[a];break}o[r]=n,o[r+1]=i,e(o,o,r,l)}),f.inverse=y(function(t,o,r){for(var a=Math.abs(t[r+1]),n=null,i=0;i<v.length;i++)if(a>=v[i]){n=S[i];break}e(t,o,r,n)});var _={},C=Math.PI,b=6378245,T=.006693421622965943;_.toWGS84=y(function(e,r,a){var n=e[a],i=e[a+1];if(!o(n,i)){var l=t(n,i);n-=l[0],i-=l[1]}r[a]=n,r[a+1]=i}),_.fromWGS84=y(function(e,r,a){var n=e[a],i=e[a+1];if(!o(n,i)){var l=t(n,i);n+=l[0],i+=l[1]}r[a]=n,r[a+1]=i});var M={},k=3e3*C/180;M.toWGS84=function(e,t,o){var a=y(r)(e,t,o);return _.toWGS84(a,a,o)},M.fromWGS84=function(e,t,o){var r=_.fromWGS84(e,t,o);return y(a)(r,r,o)};var P={};P.smerc2bmerc=function(e,t,o){var r=d.inverse(e,t,o);return r=M.fromWGS84(r,r,o),f.forward(r,r,o)},P.bmerc2smerc=function(e,t,o){var r=f.inverse(e,t,o);return r=M.toWGS84(r,r,o),d.forward(r,r,o)},P.bmerc2ll=function(e,t,o){var r=f.inverse(e,t,o);return M.toWGS84(r,r,o)},P.ll2bmerc=function(e,t,o){var r=M.fromWGS84(e,t,o);return f.forward(r,r,o)},P.ll2smerc=d.forward,P.smerc2ll=d.inverse;var B=[72.004,.8293,137.8347,55.8271],F=new ol.proj.Projection({code:"baidu",extent:ol.extent.applyTransform(B,P.ll2bmerc),units:"m"});ol.proj.addProjection(F),ol.proj.addCoordinateTransforms("EPSG:4326",F,P.ll2bmerc,P.bmerc2ll),ol.proj.addCoordinateTransforms("EPSG:3857",F,P.smerc2bmerc,P.bmerc2smerc);for(var x=new Array(19),D=0;D<19;++D)x[D]=Math.pow(2,18-D);var E={singleclick:function(e){var t=i(e);if(!t.getDrawLineState()&&!t.getDrawShapeState()){var o=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e}),r=n(t,"singleclick");if(o){if(o instanceof ol.DevFeature||o instanceof ol.AreaFeature||o instanceof ol.LineFeature||o instanceof ol.CountFeature){var a=o.extProperties.markerType;""===o.extProperties.markerType&&(a="common");var l=t.eventCallback.singleclick[a];l?l.call(this,{feature:o.extProperties,eventType:"singleclick",coordinate:e.coordinate}):null!==r&&r.call(this,{feature:o.extProperties,eventType:"singleclick",coordinate:e.coordinate})}}else null!==r&&r.call(this,{feature:null,eventType:"singleclick",coordinate:e.coordinate})}},dragstart:function(e){var t=i(e);if(t.getDragState()){var o=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});null!==t.eventCallback.dragstart.default&&t.eventCallback.dragstart.default.call(this,{feature:o,eventType:"dragstart",coordinate:e.coordinate})}},dragend:function(e){var t=i(e);if(t.getDragState()){var o=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});null!==t.eventCallback.dragend.default&&t.eventCallback.dragend.default.call(this,{feature:o,eventType:"dragend",coordinate:e.coordinate})}},selected:function(e){var t=i(e);if(t.getDragState()){var o=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});null!==t.eventCallback.selected.default&&t.eventCallback.selected.default.call(this,{feature:o,eventType:"selected",coordinate:e.coordinate})}},cancelSelected:function(e){var t=i(e);if(t.getDragState()){var o=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});null!==t.eventCallback.cancelSelected.default&&t.eventCallback.cancelSelected.default.call(this,{feature:o,eventType:"cancelSelected",coordinate:e.coordinate})}},pointermove:function(e){var t=i(e),o=t.getLayerByKey("gisLayer"),r=n(t,"pointermove");if(o){var a=o.getSource().getFeaturesAtCoordinate(e.coordinate);if(a.length>0)a[0].setStyle(hdmap.commonConfig.getMouseOverAreaStyle()),r&&r.call(this,{feature:a[0],eventType:"pointermove",coordinate:e.coordinate});else{for(var l=o.getSource().getFeatures(),s=0;s<l.length;s++)l[s].extProperties.visible||l[s].setStyle(null);r&&r.call(this,{feature:a[0],eventType:"pointermove",coordinate:e.coordinate})}}else r&&r.call(this,{feature:null,eventType:"pointermove",coordinate:e.coordinate})}},I={camera:"cameraLayer",video:"videoLayer",guarder:"guarderLayer",cleaner:"cleanerLayer",car:"carLayer",warning:"warningLayer",common:"commonLayer",gis:"gisLayer",line:"lineLayer",countCamera:"countCameraLayer",countWarning:"countWarningLayer",countBroadcast:"countBroadcastLayer",countCameraBase:"cameraBase",countWarningBase:"warningBase",countBroadcastBase:"broadcastBase"},A={getLayerKeyByType:function(e){return I[e]?I[e]:I.common},layerMapO:function(){return I}};l.prototype.mapInit=function(e){if(!1!==function(e){if(e.popupDom||(e.popupDom={popup:"popup",popupcloser:"popup-closer",popupcontent:"popup-content"}),e.gisEngine){if("baidu"===e.gisEngine)e.mapUrl=e.sat?hdmap.commonConfig.gisConfig.mapSatUrl:hdmap.commonConfig.gisConfig.mapUrl,e.satUrl=hdmap.commonConfig.gisConfig.SatUrl;else if("bitmap"===e.gisEngine){if(!e.mapUrl)return console.warn("bitmap without picture url"),!1;if(!e.sizeH||!e.sizeW)return console.warn("bitmap without size of the picture"),!1}}else e.gisEngine="baidu",e.mapUrl=hdmap.commonConfig.gisConfig.mapUrl,e.center=hdmap.commonConfig.gisConfig.center;return!0}(e)){if(this.popupInit(e.popupDom),"baidu"===e.gisEngine)this.initBaiduMap(e);else{if("bitmap"!==e.gisEngine)return;this.initBitmap(e)}this.copyAttr(this.mapConfig,e)}},l.prototype.initBitmap=function(e){var t=[];t.push(e.sizeW/2*-1,e.sizeH/2*-1,e.sizeW/2,e.sizeH/2);var o=new ol.proj.Projection({code:"EPSG:3857",extent:t}),r=new ol.layer.Image({source:new ol.source.ImageStatic({url:e.mapUrl,projection:o,imageExtent:t,imageSize:[e.sizeW,e.sizeH]})});this.layers.push(r),e.maxZoom||(e.maxZoom=7),e.minZoom||(e.minZoom=0),e.zoom||(e.zoom=3),this._map=new ol.Map({logo:!1,target:e.domId,overlays:[this._overlay],layers:this.layers,view:new ol.View({projection:o,center:ol.extent.getCenter(t),zoom:e.zoom,maxZoom:e.maxZoom,minZoom:e.minZoom,extent:[e.sizeW/2*-1,e.sizeH/2*-1,e.sizeW/2,e.sizeH/2]}),interactions:ol.interaction.defaults({dragPan:this.dragPan}),controls:ol.control.defaults({attribution:this.attribution,zoom:this.controlZoom})})},l.prototype.initBaiduMap=function(e){if(1===e.sat){var t=new ol.layer.Tile({source:new ol.source.XYZ({projection:"baidu",maxZoom:18,tileUrlFunction:function(t){var o=t[1],r=t[2],a=t[0],n=e.mapUrl;return n=n.replace("{x}",o).replace("{y}",r).replace("{z}",a)},tileGrid:new ol.tilegrid.TileGrid({resolutions:x,origin:[0,0],extent:ol.extent.applyTransform(B,P.ll2bmerc),tileSize:[256,256]})})}),o=new ol.layer.Tile({source:new ol.source.XYZ({projection:"baidu",maxZoom:18,tileUrlFunction:function(t){var o=t[1],r=t[2],a=t[0],n=e.satUrl;return n=n.replace("{x}",o).replace("{y}",r).replace("{z}",a)},tileGrid:new ol.tilegrid.TileGrid({resolutions:x,origin:[0,0],extent:ol.extent.applyTransform(B,P.ll2bmerc),tileSize:[256,256]})})});this.layers.push(t),this.layers.push(o)}else{var r=new ol.layer.Tile({source:new ol.source.XYZ({projection:"baidu",maxZoom:18,tileUrlFunction:function(t){var o=t[1],r=t[2],a=t[0],n=e.mapUrl;return n=n.replace("{x}",o).replace("{y}",r).replace("{z}",a)},tileGrid:new ol.tilegrid.TileGrid({resolutions:x,origin:[0,0],extent:ol.extent.applyTransform(B,P.ll2bmerc),tileSize:[256,256]})})});this.layers.push(r)}e.maxZoom||(e.maxZoom=19),e.minZoom||(e.minZoom=0),e.zoom||(e.zoom=8),e.center&&2===e.center.length||(e.center=[112.334403,39.8]),this._map=new ol.Map({layers:this.layers,target:e.domId,logo:!1,view:new ol.View({center:this.translate_4326_to_3857(this.translate_4326_to_bd09(e.center)),projection:"EPSG:3857",zoom:e.zoom,maxZoom:e.maxZoom,minZoom:e.minZoom}),interactions:ol.interaction.defaults({dragPan:this.dragPan}),controls:ol.control.defaults({attribution:this.attribution,zoom:this.controlZoom})}),this.mapConfig=e},l.prototype.initGisLayer=function(){var e=new ol.source.Vector({features:[]}),t=new ol.layer.HDVector("gisLayer",{source:e,style:null,zIndex:10});return this._map.addLayer(t),this.outterLayers.gisLayer=t,t},l.prototype.initLineLayer=function(){var e=new ol.source.Vector({features:[]}),t=new ol.layer.HDVector("lineLayer",{source:e,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#ff0033",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ff0033"})})}),zIndex:10});return this._map.addLayer(t),this.outterLayers.lineLayer=t,t},l.prototype.createPopup=function(e){var t=document.createElement("div");if(t.setAttribute("id",e.popup),t.classList.add("hdmap-ol-popup"),document.body.appendChild(t),this.popup_container=document.getElementById(e.popup),this.popup_container.classList.remove("hdmap-list-popup"),this.popup_container.classList.add("hdmap-ol-popup"),!this.popup_closestatus){var o=document.createElement("a");o.setAttribute("id",e.popupcloser),this.popup_container.appendChild(o),this.popup_closer=document.getElementById(e.popupcloser),this.popup_closer.classList.remove("hdmap-list-popup-closer"),this.popup_closer.classList.add("hdmap-ol-popup-closer")}var r=document.createElement("div");r.setAttribute("id",e.popupcontent),this.popup_container.appendChild(r),this.popup_content=document.getElementById(e.popupcontent)},l.prototype.popupInit=function(e){if(!document.getElementById(this._outPopupWarp)){var t=document.createElement("div");t.id=this._outPopupWarp,t.style.zIndex="-1",document.body.appendChild(t)}e&&(this.popup_closestatus=e.popupstatus,this.popup_container=document.getElementById(e.popup),this.popup_content=document.getElementById(e.popupcontent),null===this.popup_container&&this.createPopup(e),this._overlay=new ol.Overlay({element:this.popup_container,autoPan:!0,autoPanAnimation:{duration:250}}))},l.prototype.saveOutterPopup=function(e){var t=document.getElementById(this._outPopupWarp);if(t.children.length!==e.length&&e instanceof Array)for(var o=0;o<e.length;o++){var r=document.getElementById(e[o]);if(r){var a=r.parentNode;t.appendChild(r),a.parentNode.removeChild(a)}else console.warn("popId is undefined")}},l.prototype.addMarker=function(e,t){if(!e.position||!e.position[0]||!e.position[1])return console.warn("addMarker Error : marker position can not be empty"),null;var o=A.getLayerKeyByType(e.markerType),r=this.getLayerByKey(o);if(void 0===r||null===r)r=this.addLayerByLayerKey(o);else{var a=this.getMarkerBylayerKey(e.id,o);if(a)return a}var n=new ol.DevFeature({geometry:new ol.geom.Point([e.position[0],e.position[1]]),name:e.name,population:4e3,rainfall:500},e,o);return n.setStyle(hdmap.commonConfig.getFeatureStyle(e,t)),n.setId(e.id),r.getSource().addFeature(n),n},l.prototype.addCountMarker=function(e){if("countWarning"===e.markerType||"countCamera"===e.markerType||"countBroadcast"===e.markerType){var t=Object.assign({},e);t.id=t.id+"base",this.addBgLayer(t);var o=A.getLayerKeyByType(e.markerType),r=this.getLayerByKey(o),a="";void 0!==r&&null!==r||(r=this.addLayerByLayerKey(o));var n=new ol.DevFeature({geometry:new ol.geom.Point([e.position[0],e.position[1]])},e,o);"countCamera"===e.markerType?a=hdmap.commonConfig.getCountCameraFeatureStyle(e):"countWarning"===e.markerType?a=hdmap.commonConfig.getCountWarningFeatureStyle(e):"countBroadcast"===e.markerType&&(a=hdmap.commonConfig.getCountBroadcastFeatureStyle(e)),n.setStyle(a),n.setId(e.id),r.getSource().addFeature(n)}else console.warn("markerType is error")},l.prototype.addBgLayer=function(e){var t=e.markerType+"Base",o=A.getLayerKeyByType(t),r=this.getLayerByKey(o);void 0!==r&&null!==r||(r=this.addLayerByLayerKey(o));var a=new ol.CountFeature({geometry:new ol.geom.Point([e.position[0]+3,e.position[1]])},e,o);"countWarning"===e.markerType?a.setStyle(hdmap.commonConfig.getCountWarningStyle(e)):"countCamera"===e.markerType?a.setStyle(hdmap.commonConfig.getCountDefaultStyle(e)):"countBroadcast"===e.markerType&&a.setStyle(hdmap.commonConfig.getCountDefaultStyle(e)),a.setId(e.id),r.getSource().addFeature(a)},l.prototype.hideCountMarkers=function(e){var t=e+"Base",o=A.getLayerKeyByType(e),r=A.getLayerKeyByType(t);this.setLayerVisible(o,!1),this.setLayerVisible(r,!1)},l.prototype.showCountMarkers=function(e){var t=e+"Base",o=A.getLayerKeyByType(e),r=A.getLayerKeyByType(t);this.setLayerVisible(o,!0),this.setLayerVisible(r,!0)},l.prototype.removeCountMarkers=function(e){var t=e+"Base",o=A.getLayerKeyByType(e),r=A.getLayerKeyByType(t);this.removeLayerByLayerKey(o),this.removeLayerByLayerKey(r)},l.prototype.addMarkerByGPS=function(e){e.GPSInfo=e.position,e.position=this.transfromWGSToBitMap(e.position),this.addMarker(e)},l.prototype.addMarkers=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var o=e[t];this.addMarker(o)}else console.warn("addMarkers require an Array instance argument")},l.prototype.hideMarkers=function(e){var t=A.getLayerKeyByType(e);this.setLayerVisible(t,!1)},l.prototype.showMarkers=function(e){var t=A.getLayerKeyByType(e);this.setLayerVisible(t,!0)},l.prototype.removeMarkerBylayerKey=function(e,t){var o=this.getLayerByKey(t);if(!o)return console.warn("please give a legal layerkey"),null;var r=o.getSource().getFeatureById(e);r&&o.getSource().removeFeature(r)},l.prototype.removeMarker=function(e){if(e.markerType&&e.id){var t=A.getLayerKeyByType(e.markerType);if(t&&"commonLayer"!==t){var o=this.getLayerByKey(t);o||console.warn("can not find this layer:"+t);var r=o.getSource().getFeatureById(e.id);r&&o.getSource().removeFeature(r)}}else console.warn("markerInfo is error")},l.prototype.updateMarker=function(e,t){var o=A.getLayerKeyByType(e.markerType),r=this.getMarkerBylayerKey(e.id,o);if(r){var a=r.getExtProperties();this.copyAttr(a,e),e.position&&r.getGeometry().setCoordinates(e.position),e.name&&r.set("name",e.name),r.setStyle(hdmap.commonConfig.getFeatureStyle(e,t))}else console.warn("this marker is error")},l.prototype.copyAttr=function(e,t){for(var o in t)e[o]=t[o]},l.prototype.getMarkerBylayerKey=function(e,t){var o=this.getLayerByKey(t);if(!o)return console.warn("please give a layerkey"),null;return o.getSource().getFeatureById(e)},l.prototype.getMarkerById=function(e){for(var t=this.getMap().getLayers().array_,o=1;o<t.length;o++){var r=t[o].getSource().getFeatureById(e);if(r)return r}},l.prototype.addArea=function(e,t){var o=this.outterLayers.gisLayer;o||(o=this.initGisLayer());var r=this.getMarkerBylayerKey(e.id,"gisLayer");if(r)return r.getGeometry().setCoordinates(e.borderPoints),r;var a=new ol.AreaFeature({geometry:new ol.geom.Polygon(e.borderPoints),geometryName:"Polygon",style:null},e,"gisLayer");return a.setId(e.id),t&&a.setStyle(hdmap.commonConfig.setAreaStyle(t)),o.getSource().addFeature(a),a},l.prototype.addAreas=function(e,t){if(e instanceof Array)for(var o=0;o<e.length;o++){var r=e[o];this.addArea(r,t)}else console.warn("addAreas require an Array instance argument")},l.prototype.updateArea=function(e,t){var o=this.getMarkerBylayerKey(e.id,"gisLayer");o?o.setStyle(t):console.warn("Warning of hdmap: not find the area")},l.prototype.removeArea=function(e){this.removeMarkerBylayerKey(e.id,"gisLayer")},l.prototype.hideArea=function(e){var t=this.getMarkerBylayerKey(e.id,"gisLayer");t.extProperties.visible=!1,t.setStyle(null)},l.prototype.showArea=function(e){var t=this.getMarkerBylayerKey(e.id,"gisLayer");t.setStyle(hdmap.commonConfig.getMouseOverAreaStyle()),t.extProperties.visible=!0},l.prototype.addLine=function(e,t){if(e&&e.borderPoints){var o=this.outterLayers.lineLayer;o||(o=this.initLineLayer());var r=null;t&&(r=new ol.style.Style({stroke:new ol.style.Stroke(t)}));var a=this.getMarkerBylayerKey(e.id,"lineLayer");if(a)return a.getGeometry().setCoordinates(e.borderPoints),r&&a.setStyle(r),a;var n=new ol.LineFeature({geometry:new ol.geom.LineString(e.borderPoints),geometryName:"LineString",style:r},e,"lineLayer");return n.setId(e.id),r&&n.setStyle(r),o.getSource().addFeature(n),n}console.warn("addLine require an lineInfo Object")},l.prototype.addLines=function(e){if(e instanceof Array){for(var t=[],o=null,r=0;r<e.length;r++){var a=e[r],n=e[r].lineStyle;o=this.addLine(a,n),t.push(o)}return t}console.warn("addLines require an Array instance argument")},l.prototype.updateLine=function(e,t){var o=this.getMarkerBylayerKey(e.id,"lineLayer");o?o.setStyle(t):console.warn("Warning of hdmap: not find the line")},l.prototype.removeLine=function(e){this.removeMarkerBylayerKey(e.id,"lineLayer")},l.prototype.hideLine=function(e){this.getMarkerBylayerKey(e.id,"lineLayer").setStyle(null)},l.prototype.getOutterLayers=function(){return this.outterLayers},l.prototype.addLayerByLayerKey=function(e){if(e){var t=new ol.source.Vector({}),o=new ol.layer.HDVector(e,{source:t,zIndex:11});return this._map.addLayer(o),this.outterLayers[e]=o,o}return console.warn("addLayer Error : layerKey can not be empty"),null},l.prototype.removeLayerByLayerKey=function(e){var t=this.getLayerByKey(e);t&&(t.getSource().clear(),this._map.removeLayer(t),delete this.outterLayers[e])},l.prototype.getLayerByKey=function(e){var t=this.outterLayers[e];if(t)return t},l.prototype.popupSetPlace=function(e){if(this._overlay.setPosition(e),this.popup_closer){var t=this;this.popup_closer.onclick=function(){t._overlay.setPosition(void 0),t.popup_closer.blur()}}},l.prototype.addPopup=function(e){if(document.getElementById(e)){var t=document.createElement("div");t.setAttribute("id",e+"-wrapper"),t.setAttribute("class","hdmap-popup-wrapper"),document.body.appendChild(t);var o=new ol.Overlay({});o.setElement(t),this._overlays[e]=o,this.getMap().addOverlay(o);var r=document.getElementById(e).offsetHeight;t.style.height=r+"px",t.appendChild(document.getElementById(e))}else console.warn("domId is none")},l.prototype.showPopup=function(e,t){if(e){var o=parseInt(document.getElementById(e).parentNode.style.height);document.getElementById(e).parentNode.style.top=-o-12+"px",this.closePopup();for(var r in this._overlays)this._overlays[r].setPosition(void 0);this._overlays[e].setPosition(t)}else console.warn("domId is none")},l.prototype.popupDefault=function(e,t){for(var o in this._overlays)this._overlays[o].setPosition(void 0);this.popup_container.classList.remove("hdmap-list-popup"),this.popup_container.classList.add("hdmap-ol-popup"),this.popup_closer.classList.remove("hdmap-list-popup-closer"),this.popup_closer.classList.add("hdmap-ol-popup-closer"),this.popup_content.innerHTML=t,this.popupSetPlace(e)},l.prototype.popupMultipoint=function(e,t){var o=this;this.popup_content.innerHTML="",this.closePopup(),this.popup_container.classList.remove("hdmap-ol-popup"),this.popup_container.classList.add("hdmap-list-popup"),this.popup_closer.classList.remove("hdmap-ol-popup-closer"),this.popup_contentWrap.length=0;for(var r=0;r<t.length;r++){var a=document.createElement("div");a.classList.add("hdmap-list-popupcontent");var n=document.createElement("img");n.src=t[r].extProperties.markerImg,n.classList.add("hdmap-list-popupimg");var i=document.createElement("p");i.classList.add("hdmap-list-popupparm"),i.innerHTML=t[r].extProperties.markerName,a.appendChild(n),a.appendChild(i),this.popup_contentWrap.push(a),this.popup_content.appendChild(a)}for(var l=this,s=function(r){o.popup_contentWrap[r].onclick=function(){l.showPopup(t[r].extProperties.markerType,e)}},p=0;p<this.popup_contentWrap.length;p++)s(p);this.popupSetPlace(e)},l.prototype.popupNoFeature=function(e){this.popup_container.classList.remove("hdmap-list-popup"),this.popup_container.classList.add("hdmap-ol-popup"),this.popup_closer.classList.remove("hdmap-list-popup-closer"),this.popup_closer.classList.add("hdmap-ol-popup-closer"),this.popup_content.innerHTML="当前位置："+e,this.popupSetPlace(e)},l.prototype.closePopup=function(){for(var e in this._overlays)this._overlays[e].setPosition(void 0);this._overlay.setPosition(void 0),this.popup_closer&&this.popup_closer.blur()},l.prototype.regDefaulEventCallback=function(){for(var e in E){var t=this._map.on(e,E[e]);this.eventKey[e]=t}},l.prototype.warnAnimation=function(e){var t=this;this._flag&&(this.getMap().on("precompose",function(){t._initNum++,t._initNum=t._initNum%80;var o=0;o=t._initNum/200+.1,t.updateArea(e,hdmap.commonConfig.getWarningAreaStyle(o)),t._flag=!1}),this.getMap().updateSize())},l.prototype.warnCancel=function(e){var t=this;this._flag||this.getMap().on("precompose",function(){t._initNum--,t._initNum=t._initNum%80,t.updateArea(e,hdmap.commonConfig.getMouseOverAreaStyle({fillColor:"transparent",strokeColor:"transparent"})),t._flag=!0})},l.prototype.regEventListener=function(e,t,o){"string"==typeof e&&"function"==typeof t&&void 0!==this.eventCallback[e]&&(o?this.eventCallback[e][o]=t:this.eventCallback[e].default=t)},l.prototype.unRegEventListener=function(e,t){"string"==typeof e&&void 0!==this.eventCallback[e]&&(t?this.eventCallback[e][t]=null:this.eventCallback[e].default=null)},l.prototype.addEventListener=function(e,t){var o=this._map.on(e,t);return this.eventKey[e]=o,o},l.prototype.removeEventListener=function(e){var t=this.eventKey[e];t&&(this._map.unByKey(t),delete this.eventKey[e])},l.prototype.getMap=function(){return this._map},l.prototype.getMapUid=function(){return this._map.ol_uid},l.prototype.drawFeature=function(e,t,o,r,a){if(e&&o&&a&&o.length>0){var n=this.getLayerByKey(a);null==n&&(n=this.addLayer(a));var i=null;if("point"===t&&o.length>0)n.setStyle(new ol.style.Style({image:new ol.style.Circle(r)})),i=new ol.Feature({id:e,geometry:new ol.geom.Point([o[0].mapX,o[0].mapY])});else if("line"===t&&o.length>0){n.setStyle(new ol.style.Style({stroke:new ol.style.Stroke(r)}));for(var l=[],s=0;s<o.length;s++){var p=[];p.push(o[s].mapX),p.push(o[s].mapY),l.push(p)}i=new ol.Feature({id:e,geometry:new ol.geom.LineString(l)})}return n.getSource().addFeature(i),i}},l.prototype.initDrawLineTool=function(e,t,o){if(!this.drawTool.lineDraw){var r=new ol.source.Vector,a=new ol.layer.Vector({source:r,style:function(r,a){var n=r.getGeometry(),i=[new ol.style.Style({stroke:new ol.style.Stroke(e)})];return"function"==typeof o&&n.forEachSegment(function(e,r){for(var a=o.call(this,e,r),n=0;n<a.length;n++)i.push(new ol.style.Style({geometry:new ol.geom.Point(a[n]),image:t}))},r),i}});this.outterLayers.drawLineLayer=a,this._map.addLayer(a),this.drawTool.lineModify=new ol.interaction.Modify({source:r}),this.drawTool.lineDraw=new ol.interaction.Draw({source:r,type:"LineString"}),this.drawTool.lineSnap=new ol.interaction.Snap({source:r})}},l.prototype.openDrawLineTool=function(e,t,o,r,a){this.setMapEditState("drawLineState"),this.initDrawLineTool(e,t,o),this._map.addInteraction(this.drawTool.lineModify),this._map.addInteraction(this.drawTool.lineDraw),this._map.addInteraction(this.drawTool.lineSnap),r&&this.drawTool.lineDraw.on("drawend",function(e){r.call(this,e)}),a&&this.drawTool.lineModify.on("modifyend",function(e){a.call(this,e)})},l.prototype.showDrawLine=function(e){var t=this.outterLayers.drawLineLayer,o=null;if(t){for(var r=t.getSource(),a=r.getFeatures(),n=[],i=0,l=a.length;i<l;i++)n=n.concat(a[i].getGeometry().getCoordinates());var s=e&&e.id?e.id:"",p=e&&e.name?e.name:"",u=e&&e.lineType?e.lineType:"";s||console.warn("showDrawLine Error : line id can not be empty"),o=this.addLine({id:s,name:p,lineType:u,borderPoints:n}),r.clear()}return o},l.prototype.editDrawLine=function(e,t,o,r,a,n){if(e&&e.borderPoints){var i=null;if(e instanceof ol.Feature)i=e;else if(e instanceof Object){var l=null;t&&(l=new ol.style.Style({stroke:new ol.style.Stroke(t)})),(i=new ol.LineFeature({geometry:new ol.geom.LineString(e.borderPoints),geometryName:"LineString",style:l},e,"lineLayer")).setId(e.id),l&&i.setStyle(l)}var s=this.outterLayers.drawLineLayer;s&&i?(s.getSource().addFeature(i),this._map.addInteraction(this.drawTool.lineModify),this._map.addInteraction(this.drawTool.lineSnap),this.setMapEditState("drawLineState")):(this.openDrawLineTool(t,o,r,a,n),(s=this.outterLayers.drawLineLayer).getSource().addFeature(i),this._map.removeInteraction(this.drawTool.lineDraw))}else console.warn("editDrawLine Error : line option can not be null")},l.prototype.createDrawIntera=function(e,t){var o,r;"Box"===e&&(e="LineString",r=2,o=function(e,t){t||(t=new ol.geom.Polygon(null));var o=e[0],r=e[1];return t.setCoordinates([[o,[o[0],r[1]],r,[r[0],o[1]],o]]),t}),this.drawTool.shapeDraw=new ol.interaction.Draw({source:t,type:e,geometryFunction:o,maxPoints:r})},l.prototype.initDrawShapeTool=function(e){var t=null;if(this.drawTool.shapeDraw){if(this.drawTool.shapeDraw.type!==e){this._map.removeInteraction(this.drawTool.shapeDraw);t=this.outterLayers.drawShapeLayer.getSource(),this.createDrawIntera(e,t)}}else{t=new ol.source.Vector({wrapX:!1});var o=new ol.layer.HDVector("drawShapeLayer",{source:t,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#33c7ff",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#33c7ff"})})})});this.drawTool.shapeModify=new ol.interaction.Modify({source:t}),this.createDrawIntera(e,t),this.drawTool.shapeSnap=new ol.interaction.Snap({source:t}),this.outterLayers.drawShapeLayer=o,this._map.addLayer(o)}},l.prototype.openDrawShapeTool=function(e,t,o){e||(e="Polygon"),this.setMapEditState("drawShapeState"),this.initDrawShapeTool(e),t&&this.drawTool.shapeDraw.on("drawend",function(e){t.call(this,e)}),o&&this.drawTool.shapeModify.on("modifyend",function(e){o.call(this,e)}),this._map.addInteraction(this.drawTool.shapeModify),this._map.addInteraction(this.drawTool.shapeDraw),this._map.addInteraction(this.drawTool.shapeSnap)},l.prototype.showDrawShape=function(e){var t=this.outterLayers.drawShapeLayer,o=null;if(t){for(var r=t.getSource(),a=r.getFeatures(),n=[],i=[],l=0,s=a.length;l<s;l++)i=i.concat(a[l].getGeometry().getCoordinates()[0]);n.push(i);var p=e&&e.id?e.id:"",u=e&&e.name?e.name:"",c=e&&e.areaType?e.areaType:"";p||console.warn("showDrawShape Error : shape id can not be empty"),o=this.addArea({id:p,name:u,areaType:c,borderPoints:n}),r.clear()}return o},l.prototype.editDrawShape=function(e){if(e&&e.borderPoints){var t=null;e instanceof ol.Feature?t=e:e instanceof Object&&(t=new ol.AreaFeature({geometry:new ol.geom.Polygon(e.borderPoints),geometryName:"Polygon",style:null},e,"drawShapeLayer")).setId(e.id);var o=this.outterLayers.drawShapeLayer;o&&t?(o.getSource().addFeature(t),this.setMapEditState("drawShapeState"),this._map.addInteraction(this.drawTool.shapeModify),this._map.addInteraction(this.drawTool.shapeSnap)):(this.openDrawShapeTool("Polygon"),(o=this.outterLayers.drawShapeLayer).getSource().addFeature(t),this._map.removeInteraction(this.drawTool.shapeDraw))}else console.warn("editDrawShape Error : line option can not be null")},l.prototype.setMapEditState=function(e){switch(e){case"drawLineState":this.drawTool.drawLineState=!0,this.closeDrawShapeTool(),this.closeDragTool();break;case"drawShapeState":this.drawTool.drawShapeState=!0,this.closeDrawLineTool(),this.closeDragTool();break;case"dragState":this.dragFeatureTool.dragState=!0,this.closeDrawLineTool(),this.closeDrawShapeTool();break;default:this.closeDrawLineTool(),this.closeDrawShapeTool(),this.closeDragTool()}this.drawTool.drawState=e},l.prototype.getMapEditState=function(){return this.drawTool.drawState?this.drawTool.drawState:""},l.prototype.closeDrawShapeTool=function(){this.drawTool.drawShapeState&&(this._map.removeInteraction(this.drawTool.shapeModify),this._map.removeInteraction(this.drawTool.shapeDraw),this._map.removeInteraction(this.drawTool.shapeSnap),this.drawTool.drawShapeState=!1,this.drawTool.drawState="")},l.prototype.closeDrawLineTool=function(){this.drawTool.drawLineState&&(this._map.removeInteraction(this.drawTool.lineModify),this._map.removeInteraction(this.drawTool.lineDraw),this._map.removeInteraction(this.drawTool.lineSnap),this.drawTool.drawLineState=!1,this.drawTool.drawState="")},l.prototype.getDrawLineState=function(){return this.drawTool.drawLineState},l.prototype.getDrawShapeState=function(){return this.drawTool.drawShapeState},l.prototype.setCenter=function(e,t){e&&(t?(this._map.getView().setZoom(t),this._map.getView().setCenter(e)):this._map.getView().setCenter(e))},l.prototype.getCenter=function(){return this._map.getView().getCenter()},l.prototype.setZoom=function(e){e&&e>this.mapConfig.maxZoom?this._map.getView().setZoom(this.mapConfig.maxZoom):e&&e<this.mapConfig.minZoom?this._map.getView().setZoom(this.mapConfig.minZoom):this._map.getView().setZoom(e)},l.prototype.getZoom=function(){return this._map.getView().getZoom()},l.prototype.getLonLat=function(e,t){var o=this._map.getEventPixel(e),r=this._map.getCoordinateFromPixel(o);return t&&(r=ol.proj.transform(r,"EPSG:3857","EPSG:4326")),r},l.prototype.setLayerVisible=function(e,t){var o=this.getLayerByKey(e);o&&(o.setVisible(t),this._map.updateSize())},l.prototype.initDragTool=function(){var e=[];for(var t in this.outterLayers)e.push(this.outterLayers[t]);this.dragFeatureTool.select=new ol.interaction.Select({filter:function(e,t){return!0},layers:e});this.dragFeatureTool.translate=new ol.interaction.Translate({features:this.dragFeatureTool.select.getFeatures()})},l.prototype.openDragTool=function(e,t,o,r){this.setMapEditState("dragState"),this.dragFeatureTool.translate&&this.dragFeatureTool.select||this.initDragTool(),e&&this.dragFeatureTool.translate.on("translatestart",e),t&&this.dragFeatureTool.translate.on("translateend",t),o&&this.dragFeatureTool.select.on("select",o),this.dragFeatureTool.select.set("multi",r),this._map.addInteraction(this.dragFeatureTool.select),this._map.addInteraction(this.dragFeatureTool.translate)},l.prototype.closeDragTool=function(){this.dragFeatureTool.dragState&&(this._map.removeInteraction(this.dragFeatureTool.select),this._map.removeInteraction(this.dragFeatureTool.translate),this.dragFeatureTool.select=null,this.dragFeatureTool.translate=null,this.dragFeatureTool.dragState=!1,this.drawTool.drawState="")},l.prototype.getDragState=function(){return this.dragFeatureTool.dragState},l.prototype.translate_4326_to_3857=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){return ol.proj.transform(e,"EPSG:4326","EPSG:3857")}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")},l.prototype.translate_3857_to_4326=function(e){return ol.proj.transform(e,"EPSG:3857","EPSG:4326")},l.prototype.translate_bd09_to_gcj02=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=e[0]-.0065,o=e[1]-.006,r=Math.sqrt(t*t+o*o)-2e-5*Math.sin(o*k),a=Math.atan2(o,t)-3e-6*Math.cos(t*k),n=[];return n.push(r*Math.cos(a)),n.push(r*Math.sin(a)),n}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")},l.prototype.translate_gcj02_to_bd09=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=e[0],o=e[1],r=Math.sqrt(t*t+o*o)+2e-5*Math.sin(o*k),a=Math.atan2(o,t)+3e-6*Math.cos(t*k),n=[];return n.push(r*Math.cos(a)+.0065),n.push(r*Math.sin(a)+.006),n}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")},l.prototype.translate_gcj02_to_4326=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var r=e[0],a=e[1];if(!o(r,a)){var n=t(r,a);r-=n[0],a-=n[1]}var i=[];return i.push(r),i.push(a),i}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")},l.prototype.translate_4326_to_gcj02=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var r=e[0],a=e[1];if(!o(r,a)){var n=t(r,a);r-=n[0],a-=n[1]}var i=[];return i.push(r),i.push(a),i}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")},l.prototype.translate_4326_to_bd09=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=this.translate_4326_to_gcj02(e);return this.translate_gcj02_to_bd09(t)}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")},l.prototype.translate_bd09_to_4326=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=this.translate_bd09_to_gcj02(e);return this.translate_gcj02_to_4326(t)}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")},l.prototype.transfromWGSToBitMap=function(e){if(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90");else{if(1===this.mapConfig.scaleType){var t=this.translate_4326_to_3857(e),o=this.translate_4326_to_3857(this.mapConfig.centerGPS);return[(t[0]-o[0])/this.mapConfig.scale,(t[1]-o[1])/this.mapConfig.scale]}console.warn("this map cannot translate GPS to XYZ")}},l.prototype.transBitmapToWGS=function(e){if(1===this.mapConfig.scaleType){var t=e[0]*this.mapConfig.scale,o=e[1]*this.mapConfig.scale,r=this.translate_4326_to_3857(this.mapConfig.centerGPS),a=[r[0]+t,r[1]+o];return this.translate_3857_to_4326(a)}console.warn("this map cannot translate XYZ to GPS")},l.prototype.getDistance=function(e,t){var o=new ol.Sphere(6378137).haversineDistance(e,t);return o=Math.round(100*o)/100},l.prototype.destroy=function(){for(var e=0;e<this.eventKey.length;e++)this._map.unByKey(this.eventKey[e]);this._map.getInteractions().clear();for(var t=this._map.getLayers(),o=0;o<t.getLength();o++)t.item(o).getSource().clear();t.clear(),delete hdmap.mapManager[this.getMapUid()]},l.prototype.clearMap=function(e){if(e.areaList)for(var t=0,o=e.areaList.length;t<o;t++)this.removeArea(e.areaList[t]);if(e.markerList)for(var r=0,a=e.markerList.length;r<a;r++)this.removeMarker(e.markerList[r]);this.removeCountMarkers("countCamera"),this.removeCountMarkers("countBroadcast"),this.removeCountMarkers("countWarning")},l.prototype.removeControl=function(e){this._map.getControls().clear()},l.prototype.removeInteraction=function(e){this._map.getInteractions().clear()},l.prototype.removeLayers=function(e){for(var t in A.layerMapO())this.removeCountMarkers(t)};var K={getDistanceByGPS:function(e,t,o){if(!(t[0]>180||t[0]<-180||t[1]>90||t[1]<-90||o[0]>180||o[0]<-180||o[1]>90||o[1]<-90))return e.getDistance(t,o);console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")},getDistanceByPoint:function(e,t,o){if(!(t.lonlatA[0]>180||t.lonlatA[0]<-180||t.lonlatA[1]>90||t.lonlatA[1]<-90||t.lonlatB[0]>180||t.lonlatB[0]<-180||t.lonlatB[1]>90||t.lonlatB[1]<-90||t.lonlatC[0]>180||t.lonlatC[0]<-180||t.lonlatC[1]>90||t.lonlatC[1]<-90)){var r=p(t,o),a=e.translate_4326_to_3857(r),n=s(e,t,o),i=o.pointA[0]*n,l=o.pointA[1]*n,u=o.pointB[0]*n,c=o.pointB[1]*n,y=[a[0]+i,a[1]+l],d=e.translate_3857_to_4326(y),h=[a[0]+u,a[1]+c],m=e.translate_3857_to_4326(h);return e.getDistance(d,m)}console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90")},getScaleByGPS:s,getCenterGPS:p,getScaleBySize:function(e,t,o,r){var a=(o/(.0254*e/72)+r/(.0254*t/72))/2;return console.log(a),a},getAreaCenter:u,getCameraCountPoint:function(e){var t=[],o=u(e)[0]-c(e)[0],r=u(e)[1];return t[0]=o,t[1]=r,t},getBroadcastCountPoint:function(e){var t=[],o=u(e)[0]+c(e)[0],r=u(e)[1];return t[0]=o,t[1]=r,t},getWarningConutPoint:function(e){var t=[],o=u(e)[0],r=u(e)[1]-c(e)[1];return t[0]=o,t[1]=r,t},judgePointInsidePolygon:function(e,t){return function(e,t){for(var o=!1,r=0,a=t.length,n=a-1;r<a;n=r,r++){if(t[r][0]===e[0]&&t[r][1]===e[1]||t[n][0]===e[0]&&t[n][1]===e[1])return"on";if(t[r][1]<e[1]&&t[n][1]>=e[1]||t[r][1]>=e[1]&&t[n][1]<e[1]){var i=t[r][0]+(e[1]-t[r][1])*(t[n][0]-t[r][0])/(t[n][1]-t[r][1]);if(i===e[0])return"on";i>e[0]&&(o=!o)}}return o?"in":"out"}(e,t)},getFeaturesInExtent:function(e,t,o){var r=e.getZoom(),a=o/Math.pow(2,r-3),n=[t[0]-a,t[1]-a,t[0]+a,t[1]+a],i=e.getOutterLayers(),l=[],s=[];for(var p in i){var u=i[p].getSource().getFeaturesInExtent(n);l.push(u)}for(var c=l.filter(function(e){return 0!==e.length}),y=0;y<c.length;y++)for(var d=c[y],h=0;h<d.length;h++){var m=d[h];m.extProperties.markerType&&s.push(m.extProperties)}return s}};goog.provide("ol.layer.HDVector"),goog.provide("ol.DevFeature"),goog.provide("ol.AreaFeature"),goog.provide("ol.LineFeature"),goog.provide("ol.CountFeature"),goog.require("ol"),goog.require("ol.layer.Vector"),goog.require("ol.Feature"),ol.layer.HDVector=function(e,t){var o=t||{},r=ol.obj.assign({},o);ol.layer.Vector.call(this,r),this.layerKey=e},ol.inherits(ol.layer.HDVector,ol.layer.Vector),ol.layer.HDVector.prototype.getLayerKey=function(){return this.layerKey},ol.DevFeature=function(e,t,o){var r=e||{},a=ol.obj.assign({},r);ol.Feature.call(this,a),this.extProperties=t,this.layerKey=o},ol.inherits(ol.DevFeature,ol.Feature),ol.DevFeature.prototype.getExtProperties=function(){return this.extProperties},ol.DevFeature.prototype.setExtProperties=function(e){this.extProperties=e},ol.DevFeature.prototype.getLayerKey=function(){return this.layerKey},ol.DevFeature.prototype.setLayerKey=function(e){this.layerKey=e},ol.AreaFeature=function(e,t,o){var r=e||{},a=ol.obj.assign({},r);ol.Feature.call(this,a),this.extProperties=t,this.layerKey=o},ol.inherits(ol.AreaFeature,ol.Feature),ol.AreaFeature.prototype.getExtProperties=function(){return this.extProperties},ol.AreaFeature.prototype.setExtProperties=function(e){this.extProperties=e},ol.AreaFeature.prototype.getLayerKey=function(){return this.layerKey},ol.AreaFeature.prototype.setLayerKey=function(e){this.layerKey=e},ol.LineFeature=function(e,t,o){var r=e||{},a=ol.obj.assign({},r);ol.Feature.call(this,a),this.extProperties=t,this.layerKey=o},ol.inherits(ol.LineFeature,ol.Feature),ol.LineFeature.prototype.getExtProperties=function(){return this.extProperties},ol.LineFeature.prototype.setExtProperties=function(e){this.extProperties=e},ol.LineFeature.prototype.getLayerKey=function(){return this.layerKey},ol.LineFeature.prototype.setLayerKey=function(e){this.layerKey=e},ol.CountFeature=function(e,t,o){var r=e||{},a=ol.obj.assign({},r);ol.Feature.call(this,a),this.extProperties=t,this.layerKey=o},ol.inherits(ol.CountFeature,ol.Feature),ol.CountFeature.prototype.getExtProperties=function(){return this.extProperties},ol.CountFeature.prototype.setExtProperties=function(e){this.extProperties=e},ol.CountFeature.prototype.getLayerKey=function(){return this.layerKey},ol.CountFeature.prototype.setLayerKey=function(e){this.layerKey=e};var W={initMap:l,utils:K,mapManager:{},commonConfig:{gisConfig:{mapType:"baidu",mapUrl:"http://online1.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&p=1&scaler=1&udt=20171115",mapSatUrl:"http://shangetu1.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46&app=webearth2&v=009&udt=20171115",SatUrl:"http://online1.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=sl&p=1&scaler=1&udt=20171115",center:[116.40348,39.923758]},getMouseOverAreaStyle:function(e){var t=e&&e.fillColor?e.fillColor:"rgba(100,149,237,0.2)",o=e&&e.strokeColor?e.strokeColor:"#1E90FF",r=e&&e.strokeWidth?e.strokeWidth:2;return new ol.style.Style({fill:new ol.style.Fill({color:t}),stroke:new ol.style.Stroke({color:o,width:r,lineDash:[5,10]})})},getFeatureStyle:function(e,t){var o=t&&t.color?t.color:"white",r=t&&t.scale?t.scale:1,a=t&&t.opacity?t.opacity:1,n=t&&t.rotation?t.rotation:0,i=!(!t||!t.rotateWithView)&&t.rotateWithView,l=!t||!t.snapToPixel||t.snapToPixel;return new ol.style.Style({image:new ol.style.Icon({src:e.imgUrl,size:e.size,color:o,opacity:a,scale:r,snapToPixel:l,rotation:n,rotateWithView:i})})},getWarningAreaStyle:function(e){return new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,0,0,"+e+")"}),stroke:new ol.style.Stroke({color:"red",width:2,lineDash:[5,10]})})},getCountCameraFeatureStyle:function(e){var t,o,r,a;switch(e.cameraNum.length){case 1:t=14,o=-2,r=[.6,.7],a="15px bold Calibri,sans-serif";break;case 2:t=14,o=-2,r=[.7,.7],a="13px bold Calibri,sans-serif";break;case 3:t=12,o=-2.8,r=[1,.6],a="12px bold Calibri,sans-serif"}return new ol.style.Style({image:new ol.style.Icon({src:e.url,size:[20,20],color:"white",scale:.8,anchor:r}),text:new ol.style.Text({text:e.cameraNum,font:a,fill:new ol.style.Fill({color:"white"}),offsetX:t,offsetY:o})})},getCountWarningFeatureStyle:function(e){var t,o,r,a;switch(e.warnNum.length){case 1:t=14,o=-2.7,r=[.7,.65],a="15px bold Calibri,sans-serif";break;case 2:t=14,o=-2.6,r=[.8,.7],a="13px bold Calibri,sans-serif";break;case 3:t=13,o=-3,r=[1,.7],a="12px bold Calibri,sans-serif"}return new ol.style.Style({image:new ol.style.Icon({src:e.url,size:[20,20],color:"white",scale:.7,anchor:r}),text:new ol.style.Text({text:e.warnNum,font:a,fill:new ol.style.Fill({color:"white"}),offsetX:t,offsetY:o})})},getCountBroadcastFeatureStyle:function(e){var t,o,r,a;switch(e.broadcastNum.length){case 1:t=14,o=-3,r=[.6,.6],a="15px bold Calibri,sans-serif";break;case 2:t=14,o=-2,r=[.7,.6],a="13px bold Calibri,sans-serif";break;case 3:t=12,o=-2.8,r=[1,.6],a="12px bold Calibri,sans-serif"}return new ol.style.Style({image:new ol.style.Icon({src:e.url,size:[20,20],color:"white",scale:.8,anchor:r}),text:new ol.style.Text({text:e.broadcastNum,font:a,fill:new ol.style.Fill({color:"white"}),offsetX:t,offsetY:o})})},getCountDefaultStyle:function(e){var t;return e.cameraNum&&(t=e.cameraNum.length<3?1:1.1),e.broadcastNum&&(t=e.broadcastNum.length<3?1:1.1),new ol.style.Style({image:new ol.style.Icon({src:e.baseUrl,size:[45,42],scale:t,offset:[0,0]})})},getCountWarningStyle:function(e){var t=e.warnNum.length<3?1:1.1;return new ol.style.Style({image:new ol.style.Icon({src:e.baseUrl,size:[45,42],scale:t,offset:[0,0]})})},setAreaStyle:function(e){var t=e&&e.fillColor?e.fillColor:"",o=e&&e.strokeColor?e.strokeColor:"",r=e&&e.strokeWidth?e.strokeWidth:"2",a=e&&e.lineDash?e.lineDash:[5,10],n=e&&e.rotation?e.rotation:0;return new ol.style.Style({fill:new ol.style.Fill({color:t}),stroke:new ol.style.Stroke({color:o,width:r,lineDash:a,rotation:n})})},getNormalRouteStyle:function(){return new ol.style.Style({stroke:new ol.style.Stroke({color:"#7740dc",width:8})})},getOfflineRouteStyle:function(){return new ol.style.Style({stroke:new ol.style.Stroke({color:"#f39826",width:8})})},getWarningRouteStyle:function(){return new ol.style.Style({stroke:new ol.style.Stroke({color:"#ff0000",width:8})})}}};return window.hdmap=W,W});
